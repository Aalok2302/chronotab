<div class="relative inline-block">
  <!-- Theme Toggle Button -->
  <button
    (click)="toggleDropdown()"
    class="min-w-[140px] sm:min-w-[140px] flex items-center gap-2 px-3 py-2 rounded-lg theme-bg-secondary hover:theme-bg-tertiary text-text-primary border border-border-primary transition-all duration-200 hover:theme-shadow hover:-translate-y-px active:translate-y-0"
    [attr.aria-expanded]="isOpen"
    aria-label="Select theme"
  >
    <span class="text-lg" *ngIf="currentTheme">{{ getThemeIcon(currentTheme.name) }}</span>
    <span class="text-sm font-medium hidden sm:inline" *ngIf="currentTheme">{{ currentTheme.displayName }}</span>
    <svg
      class="w-4 h-4 transition-transform duration-200 ml-auto"
      [class.rotate-180]="isOpen"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>

  <!-- Theme Dropdown Menu -->
  <div
    *ngIf="isOpen"
    class="absolute right-0 sm:right-0 left-0 sm:left-auto mt-2 w-48 rounded-lg theme-bg-elevated border border-border-primary theme-shadow-lg z-50 overflow-hidden opacity-0 animate-[fadeIn_0.2s_ease-out_forwards]"
    (click)="$event.stopPropagation()"
  >
    <div class="py-1">
      <button
        *ngFor="let theme of themes"
        (click)="selectTheme(theme)"
        class="relative w-full px-4 py-2 text-left flex items-center gap-3 hover:bg-background-secondary transition-colors duration-150 before:content-[''] before:absolute before:left-0 before:top-0 before:bottom-0 before:w-[3px] before:bg-transparent hover:before:bg-primary before:transition-colors"
        [class.theme-bg-tertiary]="currentTheme.name === theme.name"
        [class.before:!bg-primary]="currentTheme.name === theme.name"
      >
        <span class="text-lg">{{ getThemeIcon(theme.name) }}</span>
        <span class="text-sm text-text-primary">{{ theme.displayName }}</span>
        <svg
          *ngIf="currentTheme.name === theme.name"
          class="w-4 h-4 ml-auto text-primary"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path
            fill-rule="evenodd"
            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
            clip-rule="evenodd"
          ></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Quick Toggle Button (Alternative compact version) -->
  <!-- <button
    (click)="toggleTheme()"
    class="inline-flex items-center justify-center w-9 h-9 ml-2 p-2 rounded-full bg-background-secondary hover:bg-background-tertiary text-text-primary border border-border-primary transition-all duration-200 hover:shadow-theme hover:-translate-y-px active:translate-y-0"
    aria-label="Quick toggle theme"
  >
    <span class="text-lg" *ngIf="currentTheme">{{ getThemeIcon(currentTheme.name) }}</span>
  </button> -->
</div>

<!-- Click outside to close -->
<div
  *ngIf="isOpen"
  class="fixed inset-0 z-40"
  (click)="isOpen = false"
></div>